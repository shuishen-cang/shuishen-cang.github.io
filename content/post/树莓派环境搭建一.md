---
title: "树莓派环境搭建(一)"
date: 2020-12-15T22:15:18+08:00
draft: false
---

工作环境：ubuntu20.04
# 一、搭建交叉编译器
```bash
git clone git://github.com/raspberrypi/tools.git
cd tools
cp -r arm-bcm2708 /home/installed/opt/

# 配置路径
sudo vim ~/.bashrc
export PATH=$PATH:/home/installed/opt/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin
#export PATH=$PATH:/home/installed/opt/arm-bcm2708/arm-bcm2708hardfp-linux-gnueabi/bin
export CFLAGS_RASP="-O2 -pipe -mcpu=arm1176jzf-s -mfpu=vfp -mfloat-abi=hard -w"

# 安装32位兼容库
sudo apt install lib32ncurses6 lib32ncurses-dev

# 测试
arm-linux-gnueabihf-gcc -v
```

# 二、交叉编译qt
### 编译(在宿主机)
不带tslib

```bash
# 之前在安装qt软件的时候便已经安装了源码，因此不需要再额外下载源码
cd /home/installed/Qt5.9.9/5.9.9/Src/

# 建立编译脚本
subl mkrasp0.sh

## 脚本
#!/bin/sh
./configure -verbose \
-prefix /home/installed/opt/qt_rasp0 \
-device-option CROSS_COMPILE=bcm2708hardfp- \
-confirm-license \
-opensource \
-release \
-make libs \
-device linux-rasp-pi-g++ \
-optimized-qmake \
-pch \
-no-sql-sqlite \
-no-sqlite \
-qt-libjpeg \
-qt-libpng \
-qt-zlib \
-no-tslib \
-no-opengl \
-no-sse2 \
-no-openssl \
-no-cups \
-no-glib \
-no-dbus \
-no-xcb \
-no-iconv \
-no-separate-debug-info \
-no-qml-debug \
-skip qtdoc \
-skip qtquick1 \
-skip qtquickcontrols \
-skip qtscript \
-skip qtxmlpatterns \
-skip qtactiveqt \
-skip qtwebsockets \
-nomake examples \
-nomake tools \
-nomake tests 

#编译
chmod +x mkrasp0.sh 
./mkrasp0.sh 
make -j12
sudo make install
```
### 安装(在树莓派)
```bash
# 宿主机，进NFS目录下
mkdir 01lib
cd 01lib
mkdir fonts
cp -r /home/installed/opt/qt_rasp0/lib/ ./
cp -r /home/installed/opt/qt_rasp0/plugins/ lib
cp /usr/share/fonts/truetype/*/* fonts


# 树莓派
cd /home/pi
cp -r /mnt/01lib ./
sudo nano /etc/profile
export LD_LIBRARY_PATH=/home/pi/00lib/lib
export QT_QPA_PLATFORM_PLUGIN_PATH=/home/pi/00lib/lib/plugins
export QT_QPA_PLATFORM=linuxfb:fb=/dev/fb0
export QT_QPA_FONTDIR=/home/pi/00lib/fonts
```

# 三、交叉编译wiringpi
### 下载 & 编译(在宿主机)
```bash
# 下载库
git clone https://github.com/WiringPi/WiringPi.git

# 修改makefile
cd WiringPi-master/wiringPi
vi Makefile
# 修改：
CC		= arm-linux-gnueabihf-gcc

# 编译
make 
sudo make install

# 宿主机，进NFS目录下
cd 01lib
cp /usr/local/lib/libwiringPi.so.2.60 libwiringPi.so
```

### 安装
```bash
# 在树莓派
cp /mnt/libwiringPi.so /home/pi/00lib/lib/
sudo nano /etc/profile
export LD_LIBRARY_PATH=/home/pi/00lib/lib
```

### 使用
在QT使用
```bash
LIBS += -L/usr/lib -lwiringPi
INCLUDEPATH += /usr/local/include
```
