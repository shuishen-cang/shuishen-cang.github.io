---
title: "Hi3559a_开发(一)-系统编译"
date: 2020-12-17T10:23:59+08:00
draft: false
tags: ["Hi3559a"]
---

# 一、安装docker镜像
## 1. 导入docker镜像
由于之前已经搭建好了docker的运行环境，之前已经设置好了海思3559a的docker镜像，因此需要开启一个新的docker容器。
我的海思sdk、用户程序以及tftp服务器都放在```/home/luocang/workspace/04work/02hi3559a/```路径下面，因此需要将该目录共享到docker容器上面。
```bash
# 该docker镜像以ubuntu14.04为基础，安装了海思的必要的开发工具
docker run -it --name=cang -v /home/luocang/workspace/04work/02hi3559a:/workspace hisys /bin/bash 

# 已经进入了docker系统，退出
exit
```
## 2. 安装tftp服务器，以及nfs服务器
参考[Ubuntu开发环境搭建](../../ubuntu/ubuntu开发环境搭建)

在安装好了tftp服务器后，需要配置tftp服务器的根目录路径
```bash
sudo vim /etc/default/tftpd-hpa

# 修改为
TFTP_USERNAME="tftp"
TFTP_DIRECTORY="/home/luocang/workspace/04work/02hi3559a/05tftpboot"
TFTP_ADDRESS=":69"
TFTP_OPTIONS="-l -c -s"
# end

sudo service tftpd-hpa restart
```

在安装好了nfs服务器后，需要配置nfs服务器的共享路径权限
```bash
sudo vim /etc/exports

# 添加
/home/luocang/workspace/04work/02hi3559a *(rw,sync,no_subtree_check)
# end

sudo service nfs-server restart
```

# 二、系统编译
海思提供一键编译，编译好的文件包括uboot、内核、根文件系等，编译好的文件通过tftp下载到板卡中，因此需要讲输出文件拷贝到tftp根目录下面。
## 1. 解压

先进入sdk，并且对sdk进行解压。
```bash
docker start cang
docker attach cang  # 进入docker容器内部

cd /workspace/......./Hi3559AV100_SDK_V2.0.2.0/
./sdk.cleanup 
./sdk.unpack
```

文件已经解压到了sdk目录中，但是编译之前需要下载内核文件，我下载的内核放在sdk平行的目录中，因此在编译前需要将内核文件拷贝到kernel路径下。
```bash
cp ../linux-4.9.37.tar.gz osdrv/opensource/kernel/
```

## 2. 编译
底层相关部分都放在osdrv路径下面，建立一个脚本来进行编译。
```bash
cd osdrv
vim make.sh

# 添加
rm -rf /workspace/05tftpboot/*
make BOOT_MEDIA=emmc AMP_TYPE=linux all
# end

chmod +x make.sh
./make.sh
```

当编译完毕后，将生成的文件拷贝到tftpd服务器下面。
```bash

cp pub/emmc_image_glibc_multi-core_arm64/* /workspace/05tftpboot/

```
所有的跟系统相关的可执行文件便已经复制到tftpd根目录下面了。



