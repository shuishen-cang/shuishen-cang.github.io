<!doctype html>
<html lang="en-us">
  <head>
    <title>Hi3559a_系统编译(一) // 洛沧</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.68.3" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://shuishen-cang.github.io/css/main.min.98d725446055c7d6e9d648a0493139d9b9363294627276b951f06d5d19331003.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Hi3559a_系统编译(一)"/>
<meta name="twitter:description" content="一、安装docker镜像 1. 导入docker镜像 由于之前已经搭建好了docker的运行环境，之前已经设置好了海思3559a的docker镜像，因此需要开启一个新的docker容器。 我的海思sdk、用户程序以及tftp服务器都放在/home/luocang/workspace/04work/02hi3559a/路径下面，因此需要将该目录共享到docker容器上面。
# 该docker镜像以ubuntu14.04为基础，安装了海思的必要的开发工具 docker run -it --name=cang -v /home/luocang/workspace/04work/02hi3559a:/workspace hisys /bin/bash # 已经进入了docker系统，退出 exit 2. 安装tftp服务器，以及nfs服务器 参考Ubuntu开发环境搭建
在安装好了tftp服务器后，需要配置tftp服务器的根目录路径
sudo vim /etc/default/tftpd-hpa # 修改为 TFTP_USERNAME=&#34;tftp&#34; TFTP_DIRECTORY=&#34;/home/luocang/workspace/04work/02hi3559a/05tftpboot&#34; TFTP_ADDRESS=&#34;:69&#34; TFTP_OPTIONS=&#34;-l -c -s&#34; # end sudo service tftpd-hpa restart 在安装好了nfs服务器后，需要配置nfs服务器的共享路径权限
sudo vim /etc/exports # 添加 /home/luocang/workspace/04work/02hi3559a *(rw,sync,no_subtree_check) # end sudo service nfs-server restart 二、系统编译 海思提供一键编译，编译好的文件包括uboot、内核、根文件系等，编译好的文件通过tftp下载到板卡中，因此需要讲输出文件拷贝到tftp根目录下面。
1. 解压 先进入sdk，并且对sdk进行解压。
docker start cang docker attach cang # 进入docker容器内部 cd /workspace/......./Hi3559AV100_SDK_V2.0.2.0/ ./sdk.cleanup ./sdk.unpack 文件已经解压到了sdk目录中，但是编译之前需要下载内核文件，我下载的内核放在sdk平行的目录中，因此在编译前需要将内核文件拷贝到kernel路径下。"/>

    <meta property="og:title" content="Hi3559a_系统编译(一)" />
<meta property="og:description" content="一、安装docker镜像 1. 导入docker镜像 由于之前已经搭建好了docker的运行环境，之前已经设置好了海思3559a的docker镜像，因此需要开启一个新的docker容器。 我的海思sdk、用户程序以及tftp服务器都放在/home/luocang/workspace/04work/02hi3559a/路径下面，因此需要将该目录共享到docker容器上面。
# 该docker镜像以ubuntu14.04为基础，安装了海思的必要的开发工具 docker run -it --name=cang -v /home/luocang/workspace/04work/02hi3559a:/workspace hisys /bin/bash # 已经进入了docker系统，退出 exit 2. 安装tftp服务器，以及nfs服务器 参考Ubuntu开发环境搭建
在安装好了tftp服务器后，需要配置tftp服务器的根目录路径
sudo vim /etc/default/tftpd-hpa # 修改为 TFTP_USERNAME=&#34;tftp&#34; TFTP_DIRECTORY=&#34;/home/luocang/workspace/04work/02hi3559a/05tftpboot&#34; TFTP_ADDRESS=&#34;:69&#34; TFTP_OPTIONS=&#34;-l -c -s&#34; # end sudo service tftpd-hpa restart 在安装好了nfs服务器后，需要配置nfs服务器的共享路径权限
sudo vim /etc/exports # 添加 /home/luocang/workspace/04work/02hi3559a *(rw,sync,no_subtree_check) # end sudo service nfs-server restart 二、系统编译 海思提供一键编译，编译好的文件包括uboot、内核、根文件系等，编译好的文件通过tftp下载到板卡中，因此需要讲输出文件拷贝到tftp根目录下面。
1. 解压 先进入sdk，并且对sdk进行解压。
docker start cang docker attach cang # 进入docker容器内部 cd /workspace/......./Hi3559AV100_SDK_V2.0.2.0/ ./sdk.cleanup ./sdk.unpack 文件已经解压到了sdk目录中，但是编译之前需要下载内核文件，我下载的内核放在sdk平行的目录中，因此在编译前需要将内核文件拷贝到kernel路径下。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shuishen-cang.github.io/post/hi3559a/01hi3559a_%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91/" />
<meta property="article:published_time" content="2020-12-17T10:23:59+08:00" />
<meta property="article:modified_time" content="2020-12-17T10:23:59+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://shuishen-cang.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <h1>洛沧</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/tags/hi3559a">Hi3559a开发
</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/ubuntu">ubuntu系统搭建
</a>
      </nav>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/shuishen-cang" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://gitee.com/shuishen-cang/" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link">
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Hi3559a_系统编译(一)</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Dec 17, 2020
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          1 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
              <a class="tag" href="https://shuishen-cang.github.io/tags/hi3559a/">Hi3559a</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="一安装docker镜像">一、安装docker镜像</h1>
<h2 id="1-导入docker镜像">1. 导入docker镜像</h2>
<p>由于之前已经搭建好了docker的运行环境，之前已经设置好了海思3559a的docker镜像，因此需要开启一个新的docker容器。
我的海思sdk、用户程序以及tftp服务器都放在<code>/home/luocang/workspace/04work/02hi3559a/</code>路径下面，因此需要将该目录共享到docker容器上面。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 该docker镜像以ubuntu14.04为基础，安装了海思的必要的开发工具</span>
docker run -it --name<span style="color:#f92672">=</span>cang -v /home/luocang/workspace/04work/02hi3559a:/workspace hisys /bin/bash 

<span style="color:#75715e"># 已经进入了docker系统，退出</span>
exit
</code></pre></div><h2 id="2-安装tftp服务器以及nfs服务器">2. 安装tftp服务器，以及nfs服务器</h2>
<p>参考<a href="../../ubuntu/ubuntu%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">Ubuntu开发环境搭建</a></p>
<p>在安装好了tftp服务器后，需要配置tftp服务器的根目录路径</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo vim /etc/default/tftpd-hpa

<span style="color:#75715e"># 修改为</span>
TFTP_USERNAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tftp&#34;</span>
TFTP_DIRECTORY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/home/luocang/workspace/04work/02hi3559a/05tftpboot&#34;</span>
TFTP_ADDRESS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;:69&#34;</span>
TFTP_OPTIONS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-l -c -s&#34;</span>
<span style="color:#75715e"># end</span>

sudo service tftpd-hpa restart
</code></pre></div><p>在安装好了nfs服务器后，需要配置nfs服务器的共享路径权限</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo vim /etc/exports

<span style="color:#75715e"># 添加</span>
/home/luocang/workspace/04work/02hi3559a *<span style="color:#f92672">(</span>rw,sync,no_subtree_check<span style="color:#f92672">)</span>
<span style="color:#75715e"># end</span>

sudo service nfs-server restart
</code></pre></div><h1 id="二系统编译">二、系统编译</h1>
<p>海思提供一键编译，编译好的文件包括uboot、内核、根文件系等，编译好的文件通过tftp下载到板卡中，因此需要讲输出文件拷贝到tftp根目录下面。</p>
<h2 id="1-解压">1. 解压</h2>
<p>先进入sdk，并且对sdk进行解压。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker start cang
docker attach cang  <span style="color:#75715e"># 进入docker容器内部</span>

cd /workspace/......./Hi3559AV100_SDK_V2.0.2.0/
./sdk.cleanup 
./sdk.unpack
</code></pre></div><p>文件已经解压到了sdk目录中，但是编译之前需要下载内核文件，我下载的内核放在sdk平行的目录中，因此在编译前需要将内核文件拷贝到kernel路径下。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp ../linux-4.9.37.tar.gz osdrv/opensource/kernel/
</code></pre></div><h2 id="2-编译">2. 编译</h2>
<p>底层相关部分都放在osdrv路径下面，建立一个脚本来进行编译。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd osdrv
vim make.sh

<span style="color:#75715e"># 添加</span>
rm -rf /workspace/05tftpboot/*
make BOOT_MEDIA<span style="color:#f92672">=</span>emmc AMP_TYPE<span style="color:#f92672">=</span>linux all
<span style="color:#75715e"># end</span>

chmod +x make.sh
./make.sh
</code></pre></div><p>当编译完毕后，将生成的文件拷贝到tftpd服务器下面。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
cp pub/emmc_image_glibc_multi-core_arm64/* /workspace/05tftpboot/

</code></pre></div><p>所有的跟系统相关的可执行文件便已经复制到tftpd根目录下面了。</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
